CurveAdm 错误码
===

* [简介](#简介)
* [错误码分类](#错误码分类)
    * [主类](#主类)
    * [子类](#子类)
    * [通用解决方案](#通用解决方案)
    * [查看错误码列表](#查看错误码列表)
* [错误码列表](#错误码列表)

简介
---

CurveAdm 错误码是 Curve 团队为了提高用户部署成功率、指导用户解决部署中可能出现的各类问题而设计的全局唯一的跟踪码。

```yaml
---
Error-Code: 540000
Error-Description: port is already in use
Error-Clue: host=centos7-002, port=8202
How to Solve:
  * Website: https://github.com/opencurve/curveadm/wiki/errno#540000
  * Log: /root/.curveadm/logs/curveadm-2022-08-11_10-52-23.log
  * WeChat: opencurve_bot
```

| 字段                | 说明                                   |
| :---                | :---                                   |
| `Error-Code`        | 全局唯一错误码                         |
| `Error-Description` | 错误码描述                             |
| `Error-Clue`        | 重要的错误线索，对用户排查问题极其重要 |
| `How to Solve`      | 该错误码的几种解决方案                 |

错误码分类
---

错误码是一个 6 位固定长度的数字，每一个错误码由以下 3 部分组成：

 * 主类：主要错误类型
 * 子类：次要错误类型
 * 错误码：具体的错误码序列号

<img src="image/errno.jpg" width="45%" height="22%">

### 主类

| 主类 | 类别说明                                                       | 通用解决方法                              |
| :--- | :---                                                           | :---                                      |
| 0    | **初始化**相关，如创建 CurveAdm 必要的目录失败                 | [初始化类错误码](#初始化类错误码)         |
| 1    | **数据库**相关，如 SQLite 数据库初始化失败、执行 SQL 语句失败  | [数据库类错误码](#数据库类错误码)         |
| 2    | **命令行选项**相关，如用户输入的命令行选项值为无效值           | [命令行选项类错误码](#命令行选项类错误码) |
| 3    | **配置文件**相关，如解析配置文件失败、配置文件中的值不符合要求 | [配置文件类错误码](#配置文件类错误码)     |
| 4    | **通用逻辑**相关，如未找到主机、未找到集群等等                 | [通用逻辑类错误码](#通用逻辑类错误码)     |
| 5    | **预检**相关，如拓扑文件预检失败、内核预检失败、网络预检失败等 | [预检类错误码](#预检类错误码)             |
| 6    | **命令执行**相关，如执行shell 命令、docker 命令失败            | [命令执行类错误码](#命令执行类错误码)     |
| 9    | **未知错误**                                                   | [未知错误码](#未知错误码)                 |

### 子类

| 主类 | 主类说明       | 子类 | 子类说明                                             |
| :--- | :---           | :--- | :---                                                 |
| `0`  | **初始化**     | `0*` | 初始化 CurveAdm                                      |
| `1`  | **数据库**     | `0*` | SQLite 数据库初始化失败                              |
|      |                | `1*` | 执行 SQL 语句失败                                    |
| `2`  | **命令行选项** | `0*` | 主机命令相关选项                                     |
|      |                | `1*` | 服务/集群命令相关选项                                |
|      |                | `2*` | 客户端命令相关选项                                   |
| `3`  | **配置文件**   | `0*` | 配置文件通用                                         |
|      |                | `1*` | CurveAdm 配置文件相关，即 *~/.curveadm/curveadm.cfg* |
|      |                | `2*` | 主机配置文件相关，即 *hosts.yaml*                    |
|      |                | `3*` | 集群拓扑文件相关，即 *topology.yaml*                 |
|      |                | `4*` | 格式化配置文件相关，即 *format.yaml*                 |
|      |                | `5*` | 客户端配置文件相关，即 *client.yaml*                 |
| `4`  | **通用逻辑**   | `0*` | 主机相关逻辑                                         |
|      |                | `1*` | 服务相关逻辑                                         |
|      |                | `2*` | CurveBS 客户端相关逻辑                               |
|      |                | `3*` | CurveFS 客户端相关逻辑                               |
|      |                | `4*` | PolarFS 相关逻辑                                     |
|      |                | `5*` | playground 相关逻辑                                  |
| `5`  | **预检**       | `0*` | 拓扑文件预检项 *<topology\>*                         |
|      |                | `1*` | SSH 预检项 *<ssh\>*                                  |
|      |                | `2*` | 权限预检项 *<permission\>*                           |
|      |                | `3*` | 内核预检项 *<kernel\>*                               |
|      |                | `4*` | 网络预检项 *<network\>*                              |
|      |                | `5*` | 时间预检项 *<date\>*                                 |
|      |                | `6*` | 服务预检项 *<service\>*                              |
|      |                | `7*` | 客户端预检项                                         |
|      |                | `9*` | 其他预检项                                           |
| `6`  | **命令执行**   | `0*` | 命令执行通用                                         |
|      |                | `1*` | SSH 命令执行相关                                     |
|      |                | `2*` | shell 命令执行相关                                   |
|      |                | `3*` | docker 命令执行相关                                  |
|      |                | `4*` | 文件相关                                             |
|      |                | `9*` | 其他                                                 |
| `9`  | **其他**       | `*`  | 其他                                                 |

### 通用解决方案


#### 初始化类错误码

这类错误只包含 3 个错误码，极少情况下会被报告，一般跟当前中控机的系统环境有关，
用户可根据错误线索和错误码解决方案来排查即可

#### 数据库类错误码

数据库相关错误只会在以下 2 种情况中会被报告：
  * CurveAdm 版本和已存在数据库文件不兼容（如当前 CurveAdm 是 `v0.1.0` 版本，而数据库文件是 `v0.0.27` 版本的 CurveAdm 创建的）
  * CurveAdm 代码逻辑出现漏洞

遇到这类错误，如果是已经部署了重要集群的用户，我们建议立马停止手头的操作，并联系 Curve 团队的小伙伴进行排查，
以免污染数据库。而对于其他用户来说，重新安装最新版 CurveAdm 即可

#### 命令行选项类错误码

用户需根据错误线索和错误码解决方案调整命令行选项，确保其有效且正确后重新执行相关命令即可

#### 配置文件类错误码

用户需根据错误线索和错误码解决方案调整相应的配置文件，确保其有效且正确后重新执行相关操作即可

#### 通用逻辑类错误码

这类错误简单明了，用户根据错误线索和错误码解决方案解决即可

#### 预检类错误码

预检是成功部署的必要条件，我们对每一个预检错误码都提供了详细的解决方案，
用户需根据这些解决方案一一排除预检失败项， 确保通过所有预检项

#### 命令执行类错误码

由于命令执行的失败涉及过多的情况，我们在这里就不一一列举了，用户可根据错误线索和查看对应的日志来确定具体的错误，并进行排查。 这类错误大多数跟系统环境相关

#### 未知错误码

这类错误属于错误逃逸，表明错误没有被 CurveAdm 捕获到，用户可提交 issue 或添加微信群报告该错误，来帮助 CurveAdm 变得更好

### 查看错误码列表

```shell
$ curveadm -d
```

```yaml
000001 get user home dir failed
000002 create curveadm subdirectory failed
000003 init logger failed
100000 init SQLite database failed
110000 execute SQL failed which get hosts
110001 execute SQL failed which update hosts
111000 execute SQL failed which insert cluster
111001 execute SQL failed which get current cluster
111002 execute SQL failed which get cluster by name
111003 execute SQL failed which get all clusters
...
630007 remove container failed (docker rm CONTAINER)
630008 list containers failed (docker ps)
630009 run a command in container failed (docker exec CONTAINER COMMAND)
630010 copy file from container failed (docker cp CONTAINER:SRC_PATH DEST_PATH)
630011 copy file into container failed (docker cp SRC_PATH CONTAINER:DEST_PATH)
630012 get container low-level information failed (docker inspect ID)
630013 get container logs failed (docker logs ID)
690000 start crontab in container failed
900000 cancel operation
999999 unknown error
---
244 error codes
```


错误码列表
---

* [000001](errno0#000001)
* [000002](errno0#000002)
* [000003](errno0#000003)
* [100000](errno1#100000)
* [110000](errno1#110000)
* [110001](errno1#110001)
* [111000](errno1#111000)
* [111001](errno1#111001)
* [111002](errno1#111002)
* [111003](errno1#111003)
* [111004](errno1#111004)
* [111005](errno1#111005)
* [111006](errno1#111006)
* [111007](errno1#111007)
* [112000](errno1#112000)
* [112001](errno1#112001)
* [112002](errno1#112002)
* [112003](errno1#112003)
* [113000](errno1#113000)
* [113001](errno1#113001)
* [113002](errno1#113002)
* [113003](errno1#113003)
* [113004](errno1#113004)
* [114000](errno1#114000)
* [114001](errno1#114001)
* [114002](errno1#114002)
* [114003](errno1#114003)
* [115000](errno1#115000)
* [210000](errno2#210000)
* [210001](errno2#210001)
* [210002](errno2#210002)
* [210003](errno2#210003)
* [210004](errno2#210004)
* [210005](errno2#210005)
* [210006](errno2#210006)
* [220000](errno2#220000)
* [221000](errno2#221000)
* [221001](errno2#221001)
* [221002](errno2#221002)
* [221003](errno2#221003)
* [221004](errno2#221004)
* [221005](errno2#221005)
* [221006](errno2#221006)
* [221007](errno2#221007)
* [222000](errno2#222000)
* [230000](errno2#230000)
* [230001](errno2#230001)
* [230002](errno2#230002)
* [230003](errno2#230003)
* [301000](errno3#301000)
* [301002](errno3#301002)
* [301003](errno3#301003)
* [301004](errno3#301004)
* [301005](errno3#301005)
* [301006](errno3#301006)
* [301100](errno3#301100)
* [301101](errno3#301101)
* [310000](errno3#310000)
* [311000](errno3#311000)
* [311001](errno3#311001)
* [320000](errno3#320000)
* [320001](errno3#320001)
* [320002](errno3#320002)
* [320003](errno3#320003)
* [321000](errno3#321000)
* [321001](errno3#321001)
* [321002](errno3#321002)
* [321003](errno3#321003)
* [321004](errno3#321004)
* [321005](errno3#321005)
* [321006](errno3#321006)
* [321007](errno3#321007)
* [321008](errno3#321008)
* [330000](errno3#330000)
* [330001](errno3#330001)
* [330002](errno3#330002)
* [330003](errno3#330003)
* [330004](errno3#330004)
* [330005](errno3#330005)
* [330006](errno3#330006)
* [330007](errno3#330007)
* [330008](errno3#330008)
* [331000](errno3#331000)
* [331001](errno3#331001)
* [331002](errno3#331002)
* [331003](errno3#331003)
* [331004](errno3#331004)
* [332000](errno3#332000)
* [332001](errno3#332001)
* [332002](errno3#332002)
* [332003](errno3#332003)
* [332004](errno3#332004)
* [332005](errno3#332005)
* [332006](errno3#332006)
* [332007](errno3#332007)
* [332008](errno3#332008)
* [332009](errno3#332009)
* [332010](errno3#332010)
* [332011](errno3#332011)
* [340000](errno3#340000)
* [340001](errno3#340001)
* [341000](errno3#341000)
* [341001](errno3#341001)
* [341002](errno3#341002)
* [341003](errno3#341003)
* [341004](errno3#341004)
* [350000](errno3#350000)
* [350001](errno3#350001)
* [351000](errno3#351000)
* [351001](errno3#351001)
* [351002](errno3#351002)
* [351003](errno3#351003)
* [351004](errno3#351004)
* [400000](errno4#400000)
* [410001](errno4#410001)
* [410002](errno4#410002)
* [410003](errno4#410003)
* [410004](errno4#410004)
* [410005](errno4#410005)
* [410006](errno4#410006)
* [410007](errno4#410007)
* [410008](errno4#410008)
* [410009](errno4#410009)
* [410010](errno4#410010)
* [410011](errno4#410011)
* [410012](errno4#410012)
* [410013](errno4#410013)
* [410014](errno4#410014)
* [410015](errno4#410015)
* [410016](errno4#410016)
* [410017](errno4#410017)
* [410018](errno4#410018)
* [410019](errno4#410019)
* [410020](errno4#410020)
* [410021](errno4#410021)
* [410022](errno4#410022)
* [420000](errno4#420000)
* [420001](errno4#420001)
* [420002](errno4#420002)
* [420003](errno4#420003)
* [420004](errno4#420004)
* [420005](errno4#420005)
* [420006](errno4#420006)
* [420007](errno4#420007)
* [420008](errno4#420008)
* [430000](errno4#430000)
* [430001](errno4#430001)
* [430002](errno4#430002)
* [430003](errno4#430003)
* [440000](errno4#440000)
* [440001](errno4#440001)
* [440002](errno4#440002)
* [450000](errno4#450000)
* [500000](errno5#500000)
* [500001](errno5#500001)
* [500002](errno5#500002)
* [500003](errno5#500003)
* [501000](errno5#501000)
* [501001](errno5#501001)
* [502000](errno5#502000)
* [503000](errno5#503000)
* [503001](errno5#503001)
* [503002](errno5#503002)
* [503003](errno5#503003)
* [503004](errno5#503004)
* [503005](errno5#503005)
* [503006](errno5#503006)
* [503007](errno5#503007)
* [503008](errno5#503008)
* [503009](errno5#503009)
* [510000](errno5#510000)
* [520000](errno5#520000)
* [520001](errno5#520001)
* [520002](errno5#520002)
* [520003](errno5#520003)
* [530000](errno5#530000)
* [530001](errno5#530001)
* [530002](errno5#530002)
* [530003](errno5#530003)
* [540000](errno5#540000)
* [540001](errno5#540001)
* [540002](errno5#540002)
* [550000](errno5#550000)
* [550001](errno5#550001)
* [560000](errno5#560000)
* [570000](errno5#570000)
* [570001](errno5#570001)
* [570002](errno5#570002)
* [570003](errno5#570003)
* [590000](errno5#590000)
* [590001](errno5#590001)
* [590002](errno5#590002)
* [600000](errno6#600000)
* [600001](errno6#600001)
* [600002](errno6#600002)
* [600003](errno6#600003)
* [600004](errno6#600004)
* [610000](errno6#610000)
* [610001](errno6#610001)
* [610002](errno6#610002)
* [620000](errno6#620000)
* [620001](errno6#620001)
* [620002](errno6#620002)
* [620003](errno6#620003)
* [620004](errno6#620004)
* [620005](errno6#620005)
* [620006](errno6#620006)
* [620007](errno6#620007)
* [620008](errno6#620008)
* [620009](errno6#620009)
* [620010](errno6#620010)
* [620011](errno6#620011)
* [620012](errno6#620012)
* [620013](errno6#620013)
* [620014](errno6#620014)
* [620015](errno6#620015)
* [620016](errno6#620016)
* [620017](errno6#620017)
* [620018](errno6#620018)
* [620019](errno6#620019)
* [620020](errno6#620020)
* [620021](errno6#620021)
* [620022](errno6#620022)
* [620023](errno6#620023)
* [620024](errno6#620024)
* [620025](errno6#620025)
* [620026](errno6#620026)
* [620998](errno6#620998)
* [620999](errno6#620999)
* [630000](errno6#630000)
* [630001](errno6#630001)
* [630002](errno6#630002)
* [630003](errno6#630003)
* [630004](errno6#630004)
* [630005](errno6#630005)
* [630006](errno6#630006)
* [630007](errno6#630007)
* [630008](errno6#630008)
* [630009](errno6#630009)
* [630010](errno6#630010)
* [630011](errno6#630011)
* [630012](errno6#630012)
* [630013](errno6#630013)
* [690000](errno6#690000)
* [900000](errno9#900000)
* [999999](errno9#999999)

