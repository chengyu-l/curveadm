CurveAdm å¸¸è§è¿ç»´æ“ä½œ
===

* [æŸ¥çœ‹é›†ç¾¤åˆ—è¡¨](#æŸ¥çœ‹é›†ç¾¤åˆ—è¡¨)
* [åˆ‡æ¢é›†ç¾¤](#åˆ‡æ¢é›†ç¾¤)
* [æ·»åŠ é›†ç¾¤](#æ·»åŠ é›†ç¾¤)
* [åˆ é™¤é›†ç¾¤](#åˆ é™¤é›†ç¾¤)
* [å¯¼å‡ºé›†ç¾¤](#å¯¼å‡ºé›†ç¾¤)
* [å¯¼å…¥é›†ç¾¤](#å¯¼å…¥é›†ç¾¤)
* [æŸ¥çœ‹é›†ç¾¤æ‹“æ‰‘](#æŸ¥çœ‹é›†ç¾¤æ‹“æ‰‘)
* [ä¿®æ”¹é›†ç¾¤æ‹“æ‰‘](#ä¿®æ”¹é›†ç¾¤æ‹“æ‰‘)
* [å¯¹æ¯”é›†ç¾¤æ‹“æ‰‘](#å¯¹æ¯”é›†ç¾¤æ‹“æ‰‘)
* [æŸ¥çœ‹é›†ç¾¤çŠ¶æ€](#æŸ¥çœ‹é›†ç¾¤çŠ¶æ€)
* [å¯åŠ¨æœåŠ¡](#å¯åŠ¨æœåŠ¡)
* [åœæ­¢æœåŠ¡](#åœæ­¢æœåŠ¡)
* [é‡å¯æœåŠ¡](#é‡å¯æœåŠ¡)
* [ä¿®æ”¹æœåŠ¡é…ç½®](#ä¿®æ”¹æœåŠ¡é…ç½®)
* [è¿›å…¥æœåŠ¡å®¹å™¨](#è¿›å…¥æœåŠ¡å®¹å™¨)
* [æ¸…ç†é›†ç¾¤](#æ¸…ç†é›†ç¾¤)
* [æŸ¥çœ‹å®¢æˆ·ç«¯çŠ¶æ€](#æŸ¥çœ‹å®¢æˆ·ç«¯çŠ¶æ€)
* [è¿›å…¥å®¢æˆ·ç«¯å®¹å™¨](#è¿›å…¥å®¢æˆ·ç«¯å®¹å™¨)
* [è·å¾— Curve å›¢é˜ŸæŠ€æœ¯æ”¯æŒ](#è·å¾—-curve-å›¢é˜ŸæŠ€æœ¯æ”¯æŒ)

æŸ¥çœ‹é›†ç¾¤åˆ—è¡¨
---

```shell
$ curveadm cluster ls
```

è‹¥æƒ³æ˜¾ç¤ºé›†ç¾¤è¯¦ç»†ä¿¡æ¯ï¼Œå¯æ·»åŠ  `-v` é€‰é¡¹ï¼Œè¯¥é€‰é¡¹å°†æ˜¾ç¤º`é›†ç¾¤ ID`ã€`é›†ç¾¤ UUID`ã€`é›†ç¾¤åˆ›å»ºæ—¶é—´`ã€`é›†ç¾¤æè¿°`ç­‰ç›¸å…³ä¿¡æ¯ï¼š

```shell
$ curveadm cluster ls -v
```

åˆ‡æ¢é›†ç¾¤
---

åˆ‡æ¢æŒ‡å®šé›†ç¾¤ä¸ºå½“å‰ç®¡ç†é›†ç¾¤ã€‚åˆ‡æ¢é›†ç¾¤åï¼Œä¹‹åçš„æ“ä½œéƒ½å°†ä½œç”¨äºè¯¥é›†ç¾¤ã€‚

```shell
$ curveadm cluster checkout <cluster-name>
```

åˆ‡æ¢é›†ç¾¤åï¼Œå†æ¬¡æŸ¥çœ‹é›†ç¾¤åˆ—è¡¨æ—¶ï¼Œå½“å‰é›†ç¾¤åå‰ä¼šå‡ºç° `*` æ ·å›¾æ ‡ï¼Œæˆ‘ä»¬ä»¥æ­¤æ¥ç¡®å®šå½“å‰æ“ä½œé›†ç¾¤ã€‚

æ·»åŠ é›†ç¾¤
---

ç”¨æˆ·å¯åœ¨æ·»åŠ é›†ç¾¤çš„åŒæ—¶æŒ‡å®šé›†ç¾¤æ‹“æ‰‘æ–‡ä»¶ï¼Œäº¦å¯å…ˆæ·»åŠ é›†ç¾¤ï¼Œä¹‹åå†é€šè¿‡[ä¿®æ”¹é›†ç¾¤æ‹“æ‰‘](#ä¿®æ”¹é›†ç¾¤æ‹“æ‰‘)çš„æ–¹å¼æäº¤é›†ç¾¤æ‹“æ‰‘ï¼š

```shell
$ curveadm cluster add <cluster-name> [-f topology.yaml]
```

åˆ é™¤é›†ç¾¤
---

```shell
$ curveadm cluster rm <cluster-name>
```

> :warning: **è­¦å‘Šï¼š**
>
> åˆ é™¤é›†ç¾¤åï¼Œè¯¥é›†ç¾¤ç›¸å…³ä¿¡æ¯å°†å…¨éƒ¨è¢«æ¸…é™¤ï¼Œè¯·è°¨æ…æ“ä½œã€‚`curveadm` æ”¯æŒåŒæ—¶ç®¡ç†å¤šä¸ªé›†ç¾¤ï¼Œåœ¨ä¸å¿…è¦çš„æƒ…å†µä¸‹ï¼Œè¯·å‹¿åˆ é™¤é›†ç¾¤ã€‚

å¯¼å‡ºé›†ç¾¤
---

æˆ‘ä»¬å¯å°†å½“å‰é›†ç¾¤ä¿¡æ¯ä¿å­˜ä¸ºæœ¬åœ°æ–‡ä»¶ï¼Œé€šå¸¸æˆ‘ä»¬åœ¨ä»¥ä¸‹ 2 ç§æƒ…å†µä¸‹éœ€è¦å¯¼å‡ºé›†ç¾¤ï¼š
  * éœ€å°†é›†ç¾¤ä¿¡æ¯åšå®šæ—¶å¤‡ä»½ï¼Œä»¥é˜²ä¸¢å¤±
  * ä¸å…¶ä»–ç”¨æˆ·å…±äº«é›†ç¾¤ä¿¡æ¯ï¼Œä»¥ä¾›å…¶ä»–ç”¨æˆ·æ“ä½œé›†ç¾¤

```shell
$ curveadm cluster export <cluster-name> [-o database-file-path]
```

> :bulb: **æç¤ºï¼š**
>
> å¯¼å‡ºçš„é›†ç¾¤æ–‡ä»¶ä»¥é›†ç¾¤ `UUID` ä¸ºé”®ï¼Œè¯¥ `UUID` å…¨å±€å”¯ä¸€ï¼Œå€¼åˆ™ä¸»è¦ä¿å­˜äº†ä»¥ä¸‹ 2 ç±»ä¿¡æ¯ï¼š
> * é›†ç¾¤çš„æœåŠ¡é…ç½®ï¼Œå³é›†ç¾¤æ‹“æ‰‘
> * æ¯ä¸ªæœåŠ¡çš„ç›¸å…³ä¿¡æ¯ï¼ŒåŒ…æ‹¬æœåŠ¡ IDã€æœåŠ¡è¿è¡Œçš„å®¹å™¨ ID ç­‰

å¯¼å…¥é›†ç¾¤
---

```shell
$ curveadm cluster import <cluster-name> [-f database-file-path]
```

> ğŸ“¢ **æ³¨æ„ï¼š**
> * å¯¼å…¥é›†ç¾¤æ—¶æŒ‡å®šçš„é›†ç¾¤åä¸å¯ä¸å·²å­˜åœ¨çš„é›†ç¾¤åé‡å¤ï¼Œå¦åˆ™å°†å¯¼è‡´å¯¼å…¥å¤±è´¥
> * å¯¼å…¥é›†ç¾¤æ—¶ä¼šå°†é›†ç¾¤æ‹“æ‰‘åŸå°ä¸åŠ¨å¯¼å…¥ï¼Œæ‰€ä»¥å¯èƒ½ä¼šå¯¼è‡´æŸäº›é…ç½®é¡¹å¤±æ•ˆï¼Œå¦‚ SSH çš„ç§é’¥è·¯å¾„é…ç½®é¡¹ `private_key_path`ï¼Œ
> é‡åˆ°æ­¤ç±»æƒ…å†µï¼Œç”¨æˆ·å¯ä¿®æ”¹é›†ç¾¤æ‹“æ‰‘å¹¶[æäº¤](#æäº¤é›†ç¾¤æ‹“æ‰‘)åå³å¯æ­£å¸¸æ“ä½œé›†ç¾¤

æŸ¥çœ‹é›†ç¾¤æ‹“æ‰‘
---

```shell
$ curveadm config show
```

> :bulb: **æé†’ï¼š**
>
> å½“æœ¬åœ°æ‹“æ‰‘æ–‡ä»¶ä¸¢å¤±æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¿å­˜å½“å‰çš„é›†ç¾¤æ‹“æ‰‘æ¥æ¢å¤ï¼š
> ```shell
> $ curveadm config show > topology.yaml
> ```

ä¿®æ”¹é›†ç¾¤æ‹“æ‰‘
---

ä¿®æ”¹æœ¬åœ°é›†ç¾¤æ‹“æ‰‘ï¼š

```shell
$ vim topology.yaml
```

å½“æˆ‘ä»¬ä¿®æ”¹äº†æœ¬åœ°çš„æ‹“æ‰‘æ–‡ä»¶åï¼Œéœ€å‘ CurveAdm æäº¤æˆ‘ä»¬çš„ä¿®æ”¹ï¼Œé›†ç¾¤æ‹“æ‰‘æ‰èƒ½ç”Ÿæ•ˆï¼š

```shell
$ curveadm config commit <topology.yaml>
```

> :bulb: **æé†’ï¼š**
>
> åœ¨æäº¤æœ¬åœ°é›†ç¾¤æ‹“æ‰‘æ—¶ï¼Œç»ˆç«¯ä¼šæ˜¾ç¤ºæœ¬åœ°é›†ç¾¤æ‹“æ‰‘ä¸å½“æœŸé›†ç¾¤æ‹“æ‰‘ä¹‹é—´çš„å·®å¼‚ï¼Œè¯·ä»”ç»†å¯¹æ¯”ï¼Œä»¥é˜²é”™è¯¯æäº¤ã€‚

å¯¹æ¯”é›†ç¾¤æ‹“æ‰‘
---

æˆ‘ä»¬å¯é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ¥æŸ¥çœ‹æœ¬åœ°é›†ç¾¤æ‹“æ‰‘æ–‡ä»¶ä¸å½“å‰é›†ç¾¤æ‹“æ‰‘ä¹‹é—´çš„å·®å¼‚ï¼š

```shell
$ curveadm config diff <topology.yaml>
```

æŸ¥çœ‹é›†ç¾¤çŠ¶æ€
---

```shell
$ curveadm status
```

CurveAdm é»˜è®¤ä¼šæ˜¾ç¤ºæœåŠ¡ IDã€æœåŠ¡è§’è‰²ã€ä¸»æœºåã€å·²éƒ¨ç½²çš„å¤åˆ¶æœåŠ¡æ•°é‡ã€å®¹å™¨ IDã€è¿è¡ŒçŠ¶æ€ï¼š

```shell
Get Service Status: [OK]

cluster name      : my-cluster
cluster kind      : curvebs
cluster mds addr  : 10.0.1.1:6666,10.0.1.2:6666,10.0.1.3:6666
cluster mds leader: 10.0.1.1:6666 / 505da008b59c

Id            Role           Host          Replicas  Container Id  Status
--            ----           ----          -------   ------------  ------
c9570c0d0252  etcd           server-host1  1/1       ced84717bf4b  Up 45 hours
493b7831907c  etcd           server-host2  1/1       907f8b84f527  Up 45 hours
8438cc5ecb52  etcd           server-host3  1/1       44eca4798424  Up 45 hours
505da008b59c  mds            server-host1  1/1       37c05bbb39af  Up 45 hours
e7bfb934182b  mds            server-host2  1/1       044b56281928  Up 45 hours
1b322781339c  mds            server-host3  1/1       b00481b9872d  Up 45 hours
<replicas>    chunkserver    server-host1  3/3       <replicas>    RUNNING
<replicas>    chunkserver    server-host2  3/3       <replicas>    RUNNING
<replicas>    chunkserver    server-host3  3/3       <replicas>    RUNNING
2912bbdbcb48  snapshotclone  server-host1  1/1       8b7a14b872ff  Up 45 hours
b862ef6720ed  snapshotclone  server-host2  1/1       8e2a4b9e16b4  Up 45 hours
ed4533e903d9  snapshotclone  server-host3  1/1       a35c30e3143d  Up 45 hours
```

* è‹¥æƒ³æŸ¥çœ‹å…¶ä½™ä¿¡æ¯ï¼Œå¦‚ç›‘å¬ç«¯å£ã€æ—¥å¿—ç›®å½•ã€æ•°æ®ç›®å½•ç­‰ï¼Œå¯æ·»åŠ  `-v` å‚æ•°
* å¯¹äºåŒä¸€å°ä¸»æœºä¸Šçš„[å¤åˆ¶][replicas]æœåŠ¡æ¥è¯´ï¼Œå…¶çŠ¶æ€é»˜è®¤æ˜¯æŠ˜å çš„ï¼Œå¯æ·»åŠ  `-s` å‚æ•°æ¥æ˜¾ç¤ºæ¯ä¸€ä¸ªå‰¯æœ¬æœåŠ¡

å¯åŠ¨æœåŠ¡
---

```shell
$ curveadm start
```

CurveAdm é»˜è®¤å¯åŠ¨é›†ç¾¤ä¸­çš„æ‰€æœ‰æœåŠ¡ï¼Œå¦‚éœ€å¯åŠ¨æŒ‡å®šæœåŠ¡ï¼Œå¯é€šè¿‡æ·»åŠ ä»¥ä¸‹ 3 ä¸ªé€‰é¡¹æ¥å®ç°ï¼š

* `--id`: å¯åŠ¨æŒ‡å®š `id` çš„æœåŠ¡
* `--host`: å¯åŠ¨æŒ‡å®šä¸»æœºçš„æ‰€æœ‰æœåŠ¡
* `--role`: å¯åŠ¨æŒ‡å®šè§’è‰²çš„æ‰€æœ‰æœåŠ¡

ä»¥ä¸Š 3 ä¸ªé€‰é¡¹å¯ä»»æ„ç»„åˆä½¿ç”¨ï¼ŒæœåŠ¡å¯¹åº”çš„ `id`ã€`host`ã€`role` å¯é€šè¿‡ [curveadm status](#æŸ¥çœ‹é›†ç¾¤çŠ¶æ€) æ¥æŸ¥çœ‹ã€‚

#### ç¤ºä¾‹ 1ï¼š å¯åŠ¨ id ä¸º `c9570c0d0252` çš„æœåŠ¡

```shell
$ curveadm start --id c9570c0d0252
```

#### ç¤ºä¾‹ 2ï¼š å¯åŠ¨ `10.0.1.1` è¿™å°ä¸»æœºä¸Šçš„æ‰€æœ‰ `MDS` æœåŠ¡
```shell
$ curveadm start --host 10.0.1.1 --role mds
```

åœæ­¢æœåŠ¡
---

```shell
$ curveadm stop
```

CurveAdm é»˜è®¤åœæ­¢é›†ç¾¤ä¸­çš„æ‰€æœ‰æœåŠ¡ï¼Œå¦‚éœ€åœæ­¢æŒ‡å®šæœåŠ¡ï¼Œå¯é€šè¿‡æ·»åŠ ä»¥ä¸‹ 3 ä¸ªé€‰é¡¹æ¥å®ç°ï¼š

* `--id`: åœæ­¢æŒ‡å®š `id` çš„æœåŠ¡
* `--host`: åœæ­¢æŒ‡å®šä¸»æœºçš„æ‰€æœ‰æœåŠ¡
* `--role`: åœæ­¢æŒ‡å®šè§’è‰²çš„æ‰€æœ‰æœåŠ¡

ä»¥ä¸Š 3 ä¸ªé€‰é¡¹å¯ä»»æ„ç»„åˆä½¿ç”¨ï¼ŒæœåŠ¡å¯¹åº”çš„ `id`ã€`host`ã€`role` å¯é€šè¿‡ [curveadm status](#æŸ¥çœ‹é›†ç¾¤çŠ¶æ€) æ¥æŸ¥çœ‹ã€‚

#### ç¤ºä¾‹ 1ï¼š åœæ­¢ id ä¸º `c9570c0d0252` çš„æœåŠ¡

```shell
$ curveadm stop --id c9570c0d0252
```

#### ç¤ºä¾‹ 2ï¼š åœæ­¢ `10.0.1.1` è¿™å°ä¸»æœºä¸Šçš„æ‰€æœ‰ `MDS` æœåŠ¡
```shell
$ curveadm stop --host 10.0.1.1 --role mds
```

> :warning: **è­¦å‘Šï¼š**
>
> åœæ­¢æœåŠ¡å¯èƒ½é€ æˆé›†ç¾¤ä¸å¥åº·ï¼Œå¯¼è‡´å®¢æˆ·ç«¯ IO å¤±è´¥ï¼Œè¯·è°¨æ…æ“ä½œã€‚

é‡å¯æœåŠ¡
---

```shell
$ curveadm restart
```

CurveAdm é»˜è®¤é‡å¯é›†ç¾¤ä¸­çš„æ‰€æœ‰æœåŠ¡ï¼Œå¦‚éœ€é‡å¯æŒ‡å®šæœåŠ¡ï¼Œå¯é€šè¿‡æ·»åŠ ä»¥ä¸‹ 3 ä¸ªé€‰é¡¹æ¥å®ç°ï¼š

* `--id`: é‡å¯æŒ‡å®š `id` çš„æœåŠ¡
* `--host`: é‡å¯æŒ‡å®šä¸»æœºçš„æ‰€æœ‰æœåŠ¡
* `--role`: é‡å¯æŒ‡å®šè§’è‰²çš„æ‰€æœ‰æœåŠ¡

ä»¥ä¸Š 3 ä¸ªé€‰é¡¹å¯ä»»æ„ç»„åˆä½¿ç”¨ï¼ŒæœåŠ¡å¯¹åº”çš„ `id`ã€`host`ã€`role` å¯é€šè¿‡ [curveadm status](#æŸ¥çœ‹é›†ç¾¤çŠ¶æ€) æ¥æŸ¥çœ‹ã€‚

#### ç¤ºä¾‹ 1ï¼š é‡å¯ id ä¸º `c9570c0d0252` çš„æœåŠ¡

```shell
$ curveadm restart --id c9570c0d0252
```

#### ç¤ºä¾‹ 2ï¼š é‡å¯ `10.0.1.1` è¿™å°ä¸»æœºä¸Šçš„æ‰€æœ‰ `MDS` æœåŠ¡
```shell
$ curveadm restart --host 10.0.1.1 --role mds
```

ä¿®æ”¹æœåŠ¡é…ç½®
---

åœ¨é›†ç¾¤è¿è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦ä¿®æ”¹æœåŠ¡çš„é…ç½®ï¼Œå¹¶é‡å¯æœåŠ¡ã€‚å…·ä½“æ“ä½œæ­¥éª¤å¦‚ä¸‹ï¼š

#### ç¬¬ 1 æ­¥ï¼šç¼–è¾‘æœ¬åœ°é›†ç¾¤æ‹“æ‰‘æ–‡ä»¶ï¼Œä¿®æ”¹å¯¹åº”æœåŠ¡çš„é…ç½®é¡¹

```shell
$ vim topology.yaml
```

> :bulb: **æé†’ï¼š**
>
> å½“æœ¬åœ°æ‹“æ‰‘æ–‡ä»¶ä¸¢å¤±æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¿å­˜å½“å‰çš„é›†ç¾¤æ‹“æ‰‘æ¥æ¢å¤ï¼š
> ```shell
> $ curveadm config show > topology.yaml
> ```

#### ç¬¬ 2 æ­¥ï¼šæäº¤ä¿®æ”¹
```shell
$ curveadm config commit topology.yaml
```

#### ç¬¬ 3 æ­¥ï¼šé‡æ–°åŠ è½½æœåŠ¡

```shell
$ curveadm reload
```

CurveAdm é»˜è®¤é‡æ–°åŠ è½½é›†ç¾¤ä¸­çš„æ‰€æœ‰æœåŠ¡ï¼Œå¦‚éœ€é‡æ–°åŠ è½½æŒ‡å®šæœåŠ¡ï¼Œå¯é€šè¿‡æ·»åŠ ä»¥ä¸‹ 3 ä¸ªé€‰é¡¹æ¥å®ç°ï¼š

* `--id`: é‡æ–°åŠ è½½æŒ‡å®š `id` çš„æœåŠ¡
* `--host`: é‡æ–°åŠ è½½æŒ‡å®šä¸»æœºçš„æ‰€æœ‰æœåŠ¡
* `--role`: é‡æ–°åŠ è½½æŒ‡å®šè§’è‰²çš„æ‰€æœ‰æœåŠ¡

ä»¥ä¸Š 3 ä¸ªé€‰é¡¹å¯ä»»æ„ç»„åˆä½¿ç”¨ï¼ŒæœåŠ¡å¯¹åº”çš„ `id`ã€`host`ã€`role` å¯é€šè¿‡ [curveadm status](#æŸ¥çœ‹é›†ç¾¤çŠ¶æ€) æ¥æŸ¥çœ‹ã€‚

#### ç¤ºä¾‹ 1ï¼šé‡æ–°åŠ è½½ id ä¸º `c9570c0d0252` çš„æœåŠ¡

```shell
$ curveadm reload --id c9570c0d0252
```

#### ç¤ºä¾‹ 2ï¼šé‡æ–°åŠ è½½ `10.0.1.1` è¿™å°ä¸»æœºä¸Šçš„æ‰€æœ‰ `MDS` æœåŠ¡
```shell
$ curveadm reload --host 10.0.1.1 --role mds
```

> :bulb: **æé†’ï¼š**
>
> å‘½ä»¤ [restart](#é‡å¯æœåŠ¡) ä¸ `reload` çš„åŒºåˆ«åœ¨äºï¼Œ
> `reload` ä¼šæ ¹æ®å½“å‰é›†ç¾¤æ‹“æ‰‘çš„å˜æ›´ä¿®æ”¹ç›¸åº”æœåŠ¡çš„é…ç½®ï¼Œç„¶åå†é‡å¯æœåŠ¡ï¼Œ
> è€Œ `restart` åˆ™åªä¼šç®€å•çš„é‡å¯æœåŠ¡ã€‚

è¿›å…¥æœåŠ¡å®¹å™¨
---

æˆ‘ä»¬å¯ä»¥è¿œç¨‹è¿›å…¥æœåŠ¡å®¹å™¨å†…ï¼ŒæŸ¥çœ‹æœåŠ¡è¿›ç¨‹ã€é…ç½®ã€æ—¥å¿—ã€æ•°æ®ç­‰ä¿¡æ¯:

```shell
$ curveadm enter <id>
```

æœåŠ¡å¯¹åº”çš„ `id` å¯é€šè¿‡ [curveadm status](#æŸ¥çœ‹é›†ç¾¤çŠ¶æ€) æ¥æŸ¥çœ‹ã€‚

> :bulb: **æé†’ï¼š**
>
> CurveAdm é»˜è®¤è¿›å…¥è¯¥æœåŠ¡çš„æ ¹ç›®å½•ï¼ŒæœåŠ¡æ ¹ç›®å½•åŒ…å«äº†æœåŠ¡æ‰€éœ€çš„æ‰€æœ‰æ–‡ä»¶ï¼Œå…¶ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š
>
> ```shell
> /curvefs/mds  # æœåŠ¡æ ¹ç›®å½•
> |-- conf      # é…ç½®ç›®å½•
> |   `-- mds.conf
> |-- data      # æ•°æ®ç›®å½•
> |-- logs      # æ—¥å¿—ç›®å½•
> |   `-- curvefs-mds.log.INFO.20220120-142115.6
> `-- sbin      # äºŒè¿›åˆ¶ç›®å½•
>     `-- curvefs-mds
> ```

æ¸…ç†é›†ç¾¤
---

```shell
$ curveadm clean
```

CurveAdm é»˜è®¤æ¸…ç†é›†ç¾¤ä¸­æ‰€æœ‰æœåŠ¡çš„æ‰€æœ‰å¯¹è±¡ï¼Œå¦‚éœ€æ¸…ç†æŒ‡å®šæœåŠ¡æˆ–å¯¹è±¡ï¼Œå¯é€šè¿‡æ·»åŠ ä»¥ä¸‹ 4 ä¸ªé€‰é¡¹æ¥å®ç°ï¼š

* `--id`: æ¸…ç†æŒ‡å®š `id` æ‰€å¯¹åº”çš„æœåŠ¡
* `--host`: æ¸…ç†æŒ‡å®šä¸»æœºæ‰€å¯¹åº”çš„æœåŠ¡
* `--role`: æ¸…ç†æŒ‡å®šè§’è‰²æ‰€å¯¹åº”çš„æœåŠ¡
* `--only`: æ¸…ç†æŒ‡å®šå¯¹è±¡ (`log`: æ—¥å¿—ï¼Œ`data`: æ•°æ®ï¼Œ`container`: å®¹å™¨)

ä»¥ä¸Š 4 ä¸ªé€‰é¡¹å¯ä»»æ„ç»„åˆä½¿ç”¨ï¼ŒæœåŠ¡å¯¹åº”çš„ `id`ã€`host`ã€`role` å¯é€šè¿‡ [curveadm status](#æŸ¥çœ‹é›†ç¾¤çŠ¶æ€) æ¥æŸ¥çœ‹ã€‚

#### ç¤ºä¾‹ 1ï¼šæ¸…ç† id ä¸º `c9570c0d0252` æœåŠ¡çš„æ‰€æœ‰å¯¹è±¡

```shell
$ curveadm clean --id c9570c0d0252
```

#### ç¤ºä¾‹ 2ï¼šæ¸…ç†æ‰€æœ‰ MDS æœåŠ¡çš„æ—¥å¿—å’Œæ•°æ®

```shell
$ curveadm clean --role mds --only log,data
```

#### ç¤ºä¾‹ 3ï¼šæ¸…ç† `10.0.1.1` è¿™å°ä¸»æœºä¸Š `MDS` æœåŠ¡çš„æ‰€æœ‰å¯¹è±¡

```shell
$ curveadm clean --host 10.0.1.1 --role mds
```

> ğŸ“¢ **æ³¨æ„ï¼š**
>
> å½“æ¸…ç†æœåŠ¡å®¹å™¨æ—¶ï¼Œè¯·ç¡®ä¿ç›¸åº”æœåŠ¡å·²åœæ­¢ï¼Œä½ å¯ä»¥ä½¿ç”¨ [stop](#åœæ­¢æœåŠ¡) å‘½ä»¤æ¥åœæ­¢æŒ‡å®šæœåŠ¡ã€‚


æŸ¥çœ‹å®¢æˆ·ç«¯çŠ¶æ€
---

```shell
$ curveadm client status
```

CurveAdm é»˜è®¤ä¼šæ˜¾ç¤ºå®¢æˆ·ç«¯ IDã€å®¢æˆ·ç«¯ç±»å‹ã€ä¸»æœºã€å®¹å™¨ IDã€è¿è¡ŒçŠ¶æ€ã€è¾…åŠ©ä¿¡æ¯ï¼š

```shell
Get Client Status: [OK]

Id            Kind     Host          Container Id  Status       Aux Info
--            ----     ----          ------------  ------       --------
362d538778ad  curvebs  server-host1  cfa00fd01ae8  Up 36 hours  {"user":"curve","volume":"/test1"}
b0d56cfaad14  curvebs  server-host2  c0301eff2af0  Up 36 hours  {"user":"curve","volume":"/test2"}
c700e1f6acab  curvebs  server-host3  52554173a54f  Up 36 hours  {"user":"curve","volume":"/test3"}
```

è¿›å…¥å®¢æˆ·ç«¯å®¹å™¨
---

æˆ‘ä»¬å¯ä»¥è¿œç¨‹è¿›å…¥æœåŠ¡å®¹å™¨å†…ï¼ŒæŸ¥çœ‹å®¢æˆ·ç«¯è¿›ç¨‹ã€é…ç½®ã€æ—¥å¿—ã€æ•°æ®ç­‰ä¿¡æ¯:

```shell
$ curveadm client <id>
```

å®¢æˆ·ç«¯å¯¹åº”çš„ `id` å¯é€šè¿‡ [curveadm client status](#æŸ¥çœ‹å®¢æˆ·ç«¯çŠ¶æ€) æ¥æŸ¥çœ‹ã€‚

> :bulb: **æé†’ï¼š**
>
> CurveAdm é»˜è®¤è¿›å…¥è¯¥å®¢æˆ·ç«¯çš„æ ¹ç›®å½•ï¼Œå®¢æˆ·ç«¯æ ¹ç›®å½•åŒ…å«äº†æœåŠ¡æ‰€éœ€çš„æ‰€æœ‰æ–‡ä»¶ï¼Œå…¶ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š
>
> ```shell
> /curvefs/client  # æœåŠ¡æ ¹ç›®å½•
> |-- conf      # é…ç½®ç›®å½•
> |   `-- client.conf
> |-- data      # æ•°æ®ç›®å½•
> |-- logs      # æ—¥å¿—ç›®å½•
> |   `-- curvefs-client.log.INFO.20220120-142115.6
> `-- sbin      # äºŒè¿›åˆ¶ç›®å½•
>     `-- curve-fuse
> ```


è·å¾— Curve å›¢é˜ŸæŠ€æœ¯æ”¯æŒ
---

å½“ä½ çš„æœåŠ¡é‡åˆ°å¼‚å¸¸ï¼Œéœ€è¦ Curve å›¢é˜Ÿçš„æŠ€æœ¯æ”¯æŒæ—¶ï¼Œä½ å¯ä»¥é€šè¿‡ `support` å‘½ä»¤æ¥å°†é›†ç¾¤çš„ä¸€äº›å¿…è¦ä¿¡æ¯ï¼Œ
å¦‚æœåŠ¡é…ç½®å’Œæ—¥å¿—è¿›è¡Œæ‰“åŒ…å‹ç¼©ï¼Œå¹¶ä¸Šä¼ åˆ° Curve ä¸­å¿ƒã€‚
æˆ‘ä»¬ä¿è¯æ‰€æœ‰ä¿¡æ¯éƒ½å°†è¢«åŠ å¯†ï¼Œå¹¶åªæœ‰ä½ æ‹¥æœ‰ç§˜é’¥ï¼š

```shell
$ curveadm support
```

ä½ å¯ä»¥é€šè¿‡æ·»åŠ  `--client` å‚æ•°æŒ‡å®šå®¢æˆ·ç«¯ ID æ¥ä¸€å¹¶ä¸ŠæŠ¥å®¢æˆ·ç«¯æ—¥å¿—ï¼Œå®¢æˆ·ç«¯ ID å¯é€šè¿‡ [curveadm client status](#æŸ¥çœ‹å®¢æˆ·ç«¯çŠ¶æ€) æŸ¥çœ‹ã€‚

#### ç¤ºä¾‹

```shell
$ curveadm support --client 462d538778ad
```

> :bulb: **æé†’ï¼š**
>
> å½“æ•°æ®ä¸Šä¼ æˆåŠŸåï¼Œç»ˆç«¯ä¼šæ˜¾ç¤ºç›¸åº”çš„ç§˜é’¥ï¼Œè¯·å°†è¯¥ç§˜é’¥[å‘Šè¯‰ Curve å›¢é˜Ÿæˆå‘˜][support]ï¼Œä»¥ä¾›ä»–ä»¬åˆ†æåŠæ’æŸ¥é—®é¢˜ã€‚

[support]: https://github.com/opencurve/curveadm/wiki/others#%E9%97%AE%E9%A2%98%E4%B8%8E%E5%8F%8D%E9%A6%88
[replicas]: https://github.com/opencurve/curveadm/wiki/topology#replicas